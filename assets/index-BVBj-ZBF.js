(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class X{constructor(t){if(this.canvas=t,this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,!this.ctx)throw new Error("No se pudo obtener el contexto 2D del canvas");this.scenes=new Map,this.currentScene=null,this.nextScene=null,this.running=!1,this.lastTime=0,this.transitioning=!1,this.transitionDuration=.3,this.transitionProgress=0}registerScene(t,e){e.sceneManager=this,e.canvas=this.canvas,e.ctx=this.ctx,e.width=this.width,e.height=this.height,this.scenes.set(t,e)}switchTo(t,e={}){const s=this.scenes.get(t);if(!s){console.error(`Escena '${t}' no encontrada`);return}this.currentScene&&this.currentScene.exit(),this.currentScene=s,this.currentScene.enter(e),console.log(`ðŸ“º Cambio a escena: ${t}`)}start(){this.running||(this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime))}stop(){this.running=!1}pauseLoop(){this.running&&(this.running=!1,console.log("â¸ï¸ SceneManager loop pausado"))}resumeLoop(){this.running||(this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime),console.log("â–¶ï¸ SceneManager loop reanudado"))}loop(t){if(!this.running)return;const e=(t-this.lastTime)/1e3;this.lastTime=t,this.currentScene&&(this.currentScene.update(e),this.currentScene.render()),requestAnimationFrame(s=>this.loop(s))}getCurrentScene(){return this.currentScene}}class E{constructor(){this.sceneManager=null,this.canvas=null,this.ctx=null,this.width=0,this.height=0}enter(t={}){}exit(){}update(t){}render(){}}class L{constructor(t={}){this.particles=[],this.pool=[],this.maxParticles=t.maxParticles||500,this.enabled=t.enabled!==!1;for(let e=0;e<this.maxParticles;e++)this.pool.push(new G)}getParticle(){return this.pool.length>0?this.pool.pop():null}releaseParticle(t){t.reset(),this.pool.push(t)}createExplosion(t,e,s={}){if(!this.enabled)return;const a={...{count:15,color:"#ff6600",size:4,speed:100,lifetime:.8,gravity:200},...s};for(let n=0;n<a.count;n++){const r=this.getParticle();if(!r)break;const l=Math.PI*2*n/a.count+(Math.random()-.5)*.5,h=a.speed*(.7+Math.random()*.6);r.init(t,e,Math.cos(l)*h,Math.sin(l)*h,a.size,a.color,a.lifetime,a.gravity),this.particles.push(r)}}createGhostConversion(t,e){if(this.enabled)for(let s=0;s<20;s++){const i=this.getParticle();if(!i)break;const a=Math.random()*Math.PI*2,n=50+Math.random()*100;i.init(t,e,Math.cos(a)*n,Math.sin(a)*n,3+Math.random()*3,s%2===0?"#00ffff":"#00aaff",1.2,-50),this.particles.push(i)}}createTrail(t,e,s="#bd00ff"){if(!this.enabled||this.particles.length>=this.maxParticles)return;const i=this.getParticle();i&&(i.init(t+(Math.random()-.5)*8,e+(Math.random()-.5)*8,(Math.random()-.5)*20,(Math.random()-.5)*20,2+Math.random()*2,s,.4,0),this.particles.push(i))}createImpact(t,e,s,i){if(!this.enabled)return;const a=Math.atan2(i,s),n="#ff6600";for(let r=0;r<8;r++){const l=this.getParticle();if(!l)break;const h=a+Math.PI+(Math.random()-.5)*Math.PI,o=50+Math.random()*100;l.init(t,e,Math.cos(h)*o,Math.sin(h)*o,2+Math.random()*3,n,.5,100),this.particles.push(l)}}update(t){if(this.enabled)for(let e=this.particles.length-1;e>=0;e--){const s=this.particles[e];s.update(t),s.active||(this.particles.splice(e,1),this.releaseParticle(s))}}render(t){for(const e of this.particles)e.render(t)}clear(){for(const t of this.particles)this.releaseParticle(t);this.particles.length=0}getCount(){return this.particles.length}}class G{constructor(){this.reset()}init(t,e,s,i,a,n,r,l=0){this.x=t,this.y=e,this.vx=s,this.vy=i,this.size=a,this.color=n,this.lifetime=r,this.age=0,this.active=!0,this.gravity=l,this.initialSize=a}reset(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.size=0,this.color="#ffffff",this.lifetime=0,this.age=0,this.active=!1,this.gravity=0,this.initialSize=0}update(t){if(this.age+=t,this.age>=this.lifetime){this.active=!1;return}this.x+=this.vx*t,this.y+=this.vy*t,this.vy+=this.gravity*t;const e=this.age/this.lifetime;this.size=this.initialSize*(1-e)}render(t){const s=1-this.age/this.lifetime,i=this.color.replace("#",""),a=parseInt(i.substr(0,2),16),n=parseInt(i.substr(2,2),16),r=parseInt(i.substr(4,2),16);t.fillStyle=`rgba(${a}, ${n}, ${r}, ${s})`,t.fillRect(this.x-this.size/2,this.y-this.size/2,this.size,this.size)}}class j extends E{constructor(){super(),this.particleSystem=null,this.playButton={x:0,y:0,width:280,height:70,text:"JUGAR",hovered:!1,scale:1,targetScale:1},this.titlePulse=0,this.particleSpawnTimer=0,this.mouseX=0,this.mouseY=0,this.mouseMoveListener=null,this.mouseClickListener=null}enter(t={}){console.log("ðŸŽ® Entrando al menÃº principal"),this.transitioning=!1,this.particleSystem=new L({maxParticles:200,enabled:!0}),this.playButton.x=this.width/2-this.playButton.width/2,this.playButton.y=this.height/2+80,this.canvasBounds=this.canvas.getBoundingClientRect(),this.cacheGradients(),this.setupMouseListeners(),this.spawnBackgroundParticles(30)}exit(){this.mouseMoveListener&&(this.canvas.removeEventListener("mousemove",this.mouseMoveListener),this.mouseMoveListener=null),this.mouseClickListener&&(this.canvas.removeEventListener("click",this.mouseClickListener),this.mouseClickListener=null),this.particleSystem&&(this.particleSystem.clear(),this.particleSystem=null),this.canvasBounds=null,this.backgroundGradient=null,this.titleGradient=null,this.buttonGradientNormal=null,this.buttonGradientHover=null,console.log("ðŸ‘‹ Saliendo del menÃº principal")}setupMouseListeners(){this.mouseMoveListener=t=>{this.mouseX=t.clientX-this.canvasBounds.left,this.mouseY=t.clientY-this.canvasBounds.top,this.checkButtonHover()},this.mouseClickListener=t=>{const e=t.clientX-this.canvasBounds.left,s=t.clientY-this.canvasBounds.top;this.isPointInButton(e,s)&&this.startGame()},this.canvas.addEventListener("mousemove",this.mouseMoveListener),this.canvas.addEventListener("click",this.mouseClickListener)}checkButtonHover(){const t=this.playButton.hovered;this.playButton.hovered=this.isPointInButton(this.mouseX,this.mouseY),this.playButton.hovered!==t&&(this.playButton.targetScale=this.playButton.hovered?1.1:1,this.playButton.hovered&&this.particleSystem.createExplosion(this.playButton.x+this.playButton.width/2,this.playButton.y+this.playButton.height/2,{count:8,color:"#bd00ff",speed:80,size:3,lifetime:.6}))}isPointInButton(t,e){return t>=this.playButton.x&&t<=this.playButton.x+this.playButton.width&&e>=this.playButton.y&&e<=this.playButton.y+this.playButton.height}startGame(){this.transitioning||(this.transitioning=!0,console.log("ðŸŽ¯ Iniciando partida..."),this.particleSystem.createExplosion(this.playButton.x+this.playButton.width/2,this.playButton.y+this.playButton.height/2,{count:25,color:"#8b00ff",speed:150,size:5,lifetime:.8}),setTimeout(()=>{this.sceneManager.switchTo("game")},200))}spawnBackgroundParticles(t){for(let e=0;e<t;e++){const s=Math.random()*this.width,i=Math.random()*this.height;this.particleSystem.createTrail(s,i,Math.random()>.5?"#8b00ff":"#00ffff")}}update(t){this.titlePulse+=t*2;const e=8;this.playButton.scale+=(this.playButton.targetScale-this.playButton.scale)*e*t,this.particleSystem.update(t),this.particleSpawnTimer+=t,this.particleSpawnTimer>=1&&this.particleSystem.getCount()<150&&(this.spawnBackgroundParticles(1),this.particleSpawnTimer=0)}cacheGradients(){this.backgroundGradient=this.ctx.createLinearGradient(0,0,0,this.height),this.backgroundGradient.addColorStop(0,"#0a0a0a"),this.backgroundGradient.addColorStop(.5,"#1a1a2e"),this.backgroundGradient.addColorStop(1,"#0a0a0a"),this.titleGradient=this.ctx.createLinearGradient(this.width/2-300,0,this.width/2+300,0),this.titleGradient.addColorStop(0,"#bd00ff"),this.titleGradient.addColorStop(.5,"#8b00ff"),this.titleGradient.addColorStop(1,"#bd00ff");const t=this.playButton;this.buttonGradientNormal=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height),this.buttonGradientNormal.addColorStop(0,"#8b00ff"),this.buttonGradientNormal.addColorStop(1,"#6a00cc"),this.buttonGradientHover=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height),this.buttonGradientHover.addColorStop(0,"#bd00ff"),this.buttonGradientHover.addColorStop(1,"#8b00ff")}render(){this.ctx.fillStyle=this.backgroundGradient,this.ctx.fillRect(0,0,this.width,this.height),this.particleSystem.render(this.ctx),this.renderTitle(),this.renderSubtitle(),this.renderPlayButton(),this.renderFooter()}renderTitle(){this.ctx.save();const t=1+Math.sin(this.titlePulse)*.2;this.ctx.textAlign="center";for(let e=2;e>0;e--)this.ctx.fillStyle=`rgba(138, 0, 255, ${.3/e})`,this.ctx.font=`bold ${Math.floor(80*t)}px serif`,this.ctx.fillText("NIGROMANTE",this.width/2+e*3,this.height/2-100+e*3);this.ctx.fillStyle=this.titleGradient,this.ctx.font=`bold ${Math.floor(80*t)}px serif`,this.ctx.fillText("NIGROMANTE",this.width/2,this.height/2-100),this.ctx.strokeStyle="#00ffff",this.ctx.lineWidth=2,this.ctx.strokeText("NIGROMANTE",this.width/2,this.height/2-100),this.ctx.restore()}renderSubtitle(){this.ctx.save(),this.ctx.textAlign="center",this.ctx.fillStyle="#aaaaaa",this.ctx.font="24px serif",this.ctx.fillText("El Invocador de las Sombras",this.width/2,this.height/2-30),this.ctx.restore()}renderPlayButton(){this.ctx.save();const t=this.playButton,e=t.x+t.width/2,s=t.y+t.height/2;this.ctx.translate(e,s),this.ctx.scale(t.scale,t.scale),this.ctx.translate(-e,-s),t.hovered&&(this.ctx.shadowBlur=30,this.ctx.shadowColor="#bd00ff");const i=t.hovered?this.buttonGradientHover:this.buttonGradientNormal;this.roundRect(t.x,t.y,t.width,t.height,10,!0,!0),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.strokeStyle=t.hovered?"#ff00ff":"#bd00ff",this.ctx.lineWidth=t.hovered?3:2,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#ffffff",this.ctx.font="bold 32px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.text,e,s),this.ctx.restore()}renderFooter(){this.ctx.save(),this.ctx.textAlign="center",this.ctx.fillStyle="#666666",this.ctx.font="16px Arial",this.ctx.fillText("Controles: WASD - Movimiento | ESPACIO - Atacar",this.width/2,this.height-50),this.ctx.fillStyle="#444444",this.ctx.font="14px Arial",this.ctx.fillText("Â© 2026 Nigromante Game - Desarrollado con Vite + Canvas",this.width/2,this.height-20),this.ctx.restore()}roundRect(t,e,s,i,a,n,r){this.ctx.beginPath(),this.ctx.moveTo(t+a,e),this.ctx.lineTo(t+s-a,e),this.ctx.quadraticCurveTo(t+s,e,t+s,e+a),this.ctx.lineTo(t+s,e+i-a),this.ctx.quadraticCurveTo(t+s,e+i,t+s-a,e+i),this.ctx.lineTo(t+a,e+i),this.ctx.quadraticCurveTo(t,e+i,t,e+i-a),this.ctx.lineTo(t,e+a),this.ctx.quadraticCurveTo(t,e,t+a,e),this.ctx.closePath()}}class R{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i,this.vx=0,this.vy=0,this.active=!0}update(t){}render(t){}getBounds(){return{left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height}}collidesWith(t){if(!t||!t.getBounds)return!1;const e=this.getBounds(),s=t.getBounds();return!(e.right<s.left||e.left>s.right||e.bottom<s.top||e.top>s.bottom)}constrainToBounds(t,e){this.x<5&&(this.x=5,this.vx=Math.max(0,this.vx)),this.x+this.width>t-5&&(this.x=t-this.width-5,this.vx=Math.min(0,this.vx)),this.y<5&&(this.y=5,this.vy=Math.max(0,this.vy)),this.y+this.height>e-5&&(this.y=e-this.height-5,this.vy=Math.min(0,this.vy))}}class I{static renderNigromante(t,e,s,i,a,n=0,r=null){if(!t||i<=0||a<=0)return;n=Number(n)||0,t.save();const l=e+i/2,h=s+a/2,o=i*1.5,c=t.createRadialGradient(l,h,0,l,h,o);c.addColorStop(0,"rgba(138, 0, 255, 0.3)"),c.addColorStop(.5,"rgba(75, 0, 130, 0.2)"),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(l,h,o,0,Math.PI*2),t.fill();const d=Math.sin(n*2)*3;for(let m=0;m<4;m++){const C=m*Math.PI/2+n*.5,T=l+Math.cos(C)*(i*.7),y=h+Math.sin(C)*(i*.7)+d,M=2+Math.sin(n*3+m)*1;t.fillStyle="rgba(138, 0, 255, 0.8)",t.beginPath(),t.arc(T,y,M,0,Math.PI*2),t.fill()}t.fillStyle="rgba(0, 0, 0, 0.4)",t.beginPath(),t.ellipse(l,s+a,i*.4,a*.15,0,0,Math.PI*2),t.fill();const g=t.createLinearGradient(e,s,e,s+a);g.addColorStop(0,"#1a0033"),g.addColorStop(.5,"#0d001a"),g.addColorStop(1,"#000000"),t.fillStyle=g,t.beginPath(),t.moveTo(e+i*.3,s),t.lineTo(e+i*.7,s),t.quadraticCurveTo(e+i,s+a*.3,e+i,s+a),t.lineTo(e,s+a),t.quadraticCurveTo(e,s+a*.3,e+i*.3,s),t.fill(),t.strokeStyle="#4a0080",t.lineWidth=1,t.stroke(),t.fillStyle="#0a0014",t.beginPath(),t.ellipse(l,s+a*.25,i*.35,a*.25,0,0,Math.PI*2),t.fill(),t.fillStyle="#000000",t.beginPath(),t.ellipse(l,s+a*.27,i*.25,a*.18,0,0,Math.PI),t.fill();const p=s+a*.25,b=4+Math.sin(n*4)*1;t.shadowBlur=b,t.shadowColor="#00ffff",t.fillStyle="#00ffff",t.beginPath(),t.arc(l-i*.15,p,i*.08,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(l+i*.15,p,i*.08,0,Math.PI*2),t.fill(),t.shadowBlur=0;const S=e+i*.9,k=s+a*.1,A=s+a*.95;t.strokeStyle="#3d2814",t.lineWidth=i*.08,t.lineCap="round",t.beginPath(),t.moveTo(S,k+a*.15),t.lineTo(S,A),t.stroke();const B=i*.15,u=1+Math.sin(n*3)*.2,f=t.createRadialGradient(S,k,0,S,k,B*u*2);f.addColorStop(0,"rgba(138, 0, 255, 0.8)"),f.addColorStop(.5,"rgba(138, 0, 255, 0.4)"),f.addColorStop(1,"transparent"),t.fillStyle=f,t.beginPath(),t.arc(S,k,B*u*2,0,Math.PI*2),t.fill(),t.fillStyle="#8a00ff",t.beginPath(),t.arc(S,k,B*u,0,Math.PI*2),t.fill(),t.fillStyle="#bd00ff",t.beginPath(),t.arc(S-B*.3,k-B*.3,B*.4,0,Math.PI*2),t.fill(),t.restore()}static renderOrc(t,e,s,i,a,n=0,r=!1,l=null,h="warrior"){if(!t||i<=0||a<=0)return;n=Number(n)||0,r=!!r,t.save();const o=e+i/2,c=s+a/2;if(r){t.globalAlpha=.85;const u=.9+Math.sin(n*4)*.05;t.globalAlpha*=u}r||(t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.ellipse(o,s+a,i*.35,a*.12,0,0,Math.PI*2),t.fill());let d,g,p;if(r)d="#00ffff",g="#00ccff",p="#6600ff";else switch(h){case"tank":d="#1a3d0f",g="#0f2a08",p="#254d18";break;case"shaman":d="#4a6b35",g="#3a5b25",p="#5a7b45";break;case"assassin":d="#6b7a5c",g="#5b6a4c",p="#7b8a6c";break;default:d="#4a7832",g="#3d6629",p="#568a3d"}const b=t.createLinearGradient(e,s,e+i,s);r?(b.addColorStop(0,"#00ccff"),b.addColorStop(.5,"#0099ff"),b.addColorStop(1,"#6600ff")):(b.addColorStop(0,g),b.addColorStop(.5,d),b.addColorStop(1,p)),t.fillStyle=b,t.fillRect(e+i*.15,s+a*.35,i*.7,a*.55),t.strokeStyle=r?"rgba(0, 200, 255, 0.5)":"rgba(0, 0, 0, 0.3)",t.lineWidth=2,t.beginPath(),t.moveTo(o,s+a*.4),t.lineTo(o,s+a*.8),t.stroke();const S=t.createRadialGradient(o,s+a*.2,0,o,s+a*.2,i*.35);r?(S.addColorStop(0,"#33ddff"),S.addColorStop(1,"#0088ff")):(S.addColorStop(0,"#527a3a"),S.addColorStop(1,"#3d6629")),t.fillStyle=S,t.beginPath(),t.ellipse(o,s+a*.22,i*.35,a*.25,0,0,Math.PI*2),t.fill(),t.fillStyle=r?"#0099ff":"#3d6629",t.beginPath(),t.moveTo(o-i*.25,s+a*.3),t.quadraticCurveTo(o,s+a*.4,o+i*.25,s+a*.3),t.quadraticCurveTo(o+i*.15,s+a*.35,o,s+a*.37),t.quadraticCurveTo(o-i*.15,s+a*.35,o-i*.25,s+a*.3),t.fill(),t.fillStyle=r?"#aaffff":"#ffffff",t.beginPath(),t.moveTo(o-i*.1,s+a*.32),t.lineTo(o-i*.08,s+a*.38),t.lineTo(o-i*.12,s+a*.38),t.fill(),t.beginPath(),t.moveTo(o+i*.1,s+a*.32),t.lineTo(o+i*.08,s+a*.38),t.lineTo(o+i*.12,s+a*.38),t.fill();const k=r?"#ffffff":"#ffff00";if(r){const u=.7+Math.sin(n*5)*.3,f=t.createRadialGradient(o-i*.125,s+a*.21,0,o-i*.125,s+a*.21,i*.2);f.addColorStop(0,`rgba(0, 255, 255, ${u})`),f.addColorStop(.5,`rgba(0, 255, 255, ${u*.5})`),f.addColorStop(1,"transparent"),t.fillStyle=f,t.beginPath(),t.arc(o-i*.125,s+a*.21,i*.2,0,Math.PI*2),t.fill();const m=t.createRadialGradient(o+i*.125,s+a*.21,0,o+i*.125,s+a*.21,i*.2);m.addColorStop(0,`rgba(0, 255, 255, ${u})`),m.addColorStop(.5,`rgba(0, 255, 255, ${u*.5})`),m.addColorStop(1,"transparent"),t.fillStyle=m,t.beginPath(),t.arc(o+i*.125,s+a*.21,i*.2,0,Math.PI*2),t.fill()}if(t.fillStyle=k,t.fillRect(o-i*.2,s+a*.15,i*.15,a*.12),t.fillRect(o+i*.05,s+a*.15,i*.15,a*.12),t.fillStyle=r?"#ff00ff":"#ff0000",t.fillRect(o-i*.15,s+a*.17,i*.08,a*.08),t.fillRect(o+i*.1,s+a*.17,i*.08,a*.08),t.shadowBlur=0,h==="shaman"){const u=r?"rgba(100, 120, 140, 0.5)":"#5d4332",f=r?"rgba(130, 110, 90, 0.6)":"#8b6c47";t.fillStyle=u,t.fillRect(e+i*.15,s+a*.35,i*.7,a*.6),t.fillStyle=f,t.beginPath(),t.arc(e+i*.2,s+a*.42,i*.15,0,Math.PI),t.fill(),t.beginPath(),t.arc(e+i*.8,s+a*.42,i*.15,0,Math.PI),t.fill(),t.fillStyle=u,t.beginPath(),t.arc(o,s+a*.18,i*.45,0,Math.PI),t.fill();const m=r?"rgba(255, 255, 200, 0.8)":"#e8d5a0";t.fillStyle=m;for(let C=0;C<5;C++)t.beginPath(),t.arc(e+i*(.25+C*.1),s+a*.48,i*.04,0,Math.PI*2),t.fill();t.strokeStyle=r?"rgba(255, 100, 255, 0.9)":"#ff3333",t.lineWidth=3,t.beginPath(),t.arc(o,s+a*.58,i*.08,0,Math.PI*2),t.stroke(),t.lineWidth=1.5,t.beginPath(),t.moveTo(o-i*.05,s+a*.55),t.lineTo(o+i*.05,s+a*.61),t.moveTo(o+i*.05,s+a*.55),t.lineTo(o-i*.05,s+a*.61),t.stroke()}else if(h==="tank"){const u=r?"rgba(120, 120, 130, 0.6)":"#4a4a4a",f=r?"rgba(80, 80, 90, 0.7)":"#2a2a2a",m=r?"rgba(180, 180, 200, 0.7)":"#707070";t.fillStyle=u,t.beginPath(),t.arc(e+i*.05,s+a*.35,i*.22,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(e+i*.95,s+a*.35,i*.22,0,Math.PI*2),t.fill(),t.fillStyle=f;for(let y=0;y<6;y++){const M=y*Math.PI/3;t.beginPath(),t.moveTo(e+i*.05,s+a*.35),t.lineTo(e+i*.05+Math.cos(M)*i*.15,s+a*.35+Math.sin(M)*i*.08),t.lineWidth=i*.02,t.stroke(),t.beginPath(),t.moveTo(e+i*.95,s+a*.35),t.lineTo(e+i*.95+Math.cos(M)*i*.15,s+a*.35+Math.sin(M)*i*.08),t.stroke()}t.fillStyle=u,t.fillRect(e+i*.1,s+a*.4,i*.8,a*.5),t.fillStyle=m,t.fillRect(e+i*.15,s+a*.42,i*.7,a*.15),t.fillStyle=u,t.fillRect(e+i*.12,s+a*.58,i*.76,a*.15),t.fillStyle=f;const C=i*.06;[[.2,.45],[.35,.45],[.5,.45],[.65,.45],[.8,.45],[.18,.62],[.32,.62],[.5,.62],[.68,.62],[.82,.62],[.25,.78],[.4,.78],[.6,.78],[.75,.78]].forEach(([y,M])=>{t.beginPath(),t.arc(e+i*y,s+a*M,C,0,Math.PI*2),t.fill(),t.fillStyle=m,t.beginPath(),t.arc(e+i*y-C*.3,s+a*M-C*.3,C*.4,0,Math.PI*2),t.fill(),t.fillStyle=f})}else if(h==="assassin"){const u=r?"rgba(40, 40, 50, 0.7)":"#1a1a1a",f=r?"rgba(60, 50, 40, 0.6)":"#2d1f14";t.fillStyle=u,t.beginPath(),t.moveTo(e+i*.1,s+a*.25),t.quadraticCurveTo(o-i*.1,s+a*.1,o+i*.3,s+a*.2),t.quadraticCurveTo(e+i*.85,s+a*.35,e+i*.8,s+a*.9),t.quadraticCurveTo(o,s+a*.95,e+i*.2,s+a*.85),t.quadraticCurveTo(e+i*.05,s+a*.6,e+i*.1,s+a*.25),t.fill(),t.fillStyle=f,t.fillRect(e+i*.25,s+a*.45,i*.5,a*.35),t.fillStyle=f,t.fillRect(e+i*.15,s+i*.65,i*.7,a*.08),t.fillStyle=u;for(let m=0;m<4;m++)t.fillRect(e+i*(.2+m*.15),s+a*.68,i*.08,a*.12);t.fillStyle=r?"rgba(80, 80, 90, 0.6)":"#3a3a3a",t.fillRect(e+i*.05,s+a*.5,i*.15,a*.12),t.fillRect(e+i*.8,s+a*.5,i*.15,a*.12)}else{const u=r?"rgba(100, 150, 200, 0.5)":"#5a3d2b";t.fillStyle=u,t.beginPath(),t.arc(e+i*.15,s+a*.4,i*.12,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(e+i*.85,s+a*.4,i*.12,0,Math.PI*2),t.fill(),t.fillRect(e+i*.2,s+a*.4,i*.6,a*.35),t.fillStyle=r?"rgba(200, 220, 255, 0.7)":"#3d2814";for(let f=0;f<3;f++)for(let m=0;m<2;m++)t.beginPath(),t.arc(e+i*(.3+f*.2),s+a*(.45+m*.15),i*.03,0,Math.PI*2),t.fill()}const A=r?"rgba(150, 200, 255, 0.6)":"#6b4423",B=r?"rgba(180, 220, 255, 0.7)":"#8c8c8c";if(h==="shaman"){const u=r?"rgba(100, 80, 60, 0.6)":"#4a3020",f=r?"rgba(255, 100, 255, 0.9)":"#ff3333",m=r?"rgba(255, 255, 200, 0.8)":"#e8d5a0";t.strokeStyle=u,t.lineWidth=i*.06,t.lineCap="round",t.beginPath(),t.moveTo(e+i*.95,s+a*.25),t.lineTo(e+i*.95,s+a*1.1),t.stroke(),t.strokeStyle=r?"rgba(70, 50, 40, 0.7)":"#2a1a10",t.lineWidth=i*.02;for(let P=0;P<8;P++)t.beginPath(),t.moveTo(e+i*.92,s+a*(.3+P*.09)),t.lineTo(e+i*.98,s+a*(.3+P*.09)),t.stroke();t.fillStyle=m,t.beginPath(),t.ellipse(e+i*.95,s+a*.2,i*.07,i*.08,0,0,Math.PI*2),t.fill(),t.fillStyle=r?"rgba(255, 50, 100, 0.8)":"#aa0000",t.beginPath(),t.arc(e+i*.92,s+a*.18,i*.02,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(e+i*.98,s+a*.18,i*.02,0,Math.PI*2),t.fill();const C=i*.08,T=C*2.5,y=1+Math.sin(n*3.5)*.15,M=t.createRadialGradient(e+i*.95,s+a*.12,0,e+i*.95,s+a*.12,T*y);M.addColorStop(0,`${f}B3`),M.addColorStop(.3,`${f}80`),M.addColorStop(1,`${f}00`),t.fillStyle=M,t.beginPath(),t.arc(e+i*.95,s+a*.12,T*y,0,Math.PI*2),t.fill(),t.fillStyle=f,t.beginPath(),t.arc(e+i*.95,s+a*.12,C*y,0,Math.PI*2),t.fill();for(let P=0;P<3;P++)t.fillStyle=`rgba(255, ${50+P*20}, ${100-P*30}, ${.6-P*.1})`,t.beginPath(),t.arc(e+i*(.93+Math.sin(n*2+P)*.03),s+a*(.08+P*.03),i*(.03-P*.008),0,Math.PI*2),t.fill()}else if(h==="tank"){const u=r?"rgba(80, 80, 90, 0.7)":"#3a3a3a",f=r?"rgba(100, 80, 60, 0.6)":"#5a3d2b",m=r?"rgba(120, 120, 140, 0.7)":"#606060";t.strokeStyle=f,t.lineWidth=i*.08,t.lineCap="round",t.beginPath(),t.moveTo(e+i*.98,s+a*.2),t.lineTo(e+i*.98,s+a*1),t.stroke(),t.strokeStyle=r?"rgba(60, 40, 30, 0.7)":"#2a1a10",t.lineWidth=i*.03;for(let y=0;y<5;y++)t.beginPath(),t.arc(e+i*.98,s+a*(.35+y*.12),i*.04,0,Math.PI*2),t.stroke();t.fillStyle=u;const C=i*.25,T=i*.18;t.fillRect(e+i*.85-C/2,s+a*.15-T/2,C,T),t.fillStyle=m,t.fillRect(e+i*.85-C/2+2,s+a*.15-T/2+2,C-4,T/3),t.fillStyle=u;for(let y=0;y<7;y++)t.beginPath(),t.moveTo(e+i*(.72+y*.04),s+a*.06),t.lineTo(e+i*(.73+y*.04),s+a*.11),t.lineTo(e+i*(.74+y*.04),s+a*.06),t.fill()}else if(h==="assassin"){const u=r?"rgba(180, 220, 255, 0.7)":"#aaaaaa",f=r?"rgba(40, 30, 20, 0.7)":"#1a1010",m=r?"rgba(80, 60, 40, 0.6)":"#3a2416";t.strokeStyle=f,t.lineWidth=i*.04,t.lineCap="round",t.beginPath(),t.moveTo(e-i*.05,s+a*.6),t.lineTo(e-i*.05,s+a*.75),t.stroke(),t.fillStyle=u,t.beginPath(),t.moveTo(e-i*.1,s+a*.5),t.lineTo(e-i*.05,s+a*.6),t.lineTo(e,s+a*.55),t.fill(),t.strokeStyle=f,t.lineWidth=i*.04,t.beginPath(),t.moveTo(e+i*1.05,s+a*.6),t.lineTo(e+i*1.05,s+a*.75),t.stroke(),t.fillStyle=u,t.beginPath(),t.moveTo(e+i*1.1,s+a*.5),t.lineTo(e+i*1.05,s+a*.6),t.lineTo(e+i,s+a*.55),t.fill(),t.fillStyle=m,t.fillRect(e+i*.91,s+a*.45,i*.06,i*.02),t.fillRect(e+i*.91,s+a*.55,i*.06,i*.02),r||(t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=1,t.beginPath(),t.moveTo(e+i*.02,s+a*.27),t.lineTo(e+i*-.02,s+a*.3),t.moveTo(e+i*.98,s+a*.27),t.lineTo(e+i*1.02,s+a*.3),t.stroke())}else t.strokeStyle=A,t.lineWidth=i*.08,t.lineCap="round",t.beginPath(),t.moveTo(e+i*.05,s+a*.5),t.lineTo(e+i*.05,s+a*.95),t.stroke(),t.fillStyle=B,t.beginPath(),t.moveTo(e-i*.05,s+a*.45),t.lineTo(e+i*.15,s+a*.35),t.lineTo(e+i*.15,s+a*.55),t.fill(),t.strokeStyle=r?"#bbddff":"#aaaaaa",t.lineWidth=1,t.stroke();if(r){t.globalAlpha=.3;const u=t.createRadialGradient(o,c,0,o,c,i*1.2);u.addColorStop(0,"rgba(0, 255, 255, 0.4)"),u.addColorStop(.5,"rgba(102, 0, 255, 0.3)"),u.addColorStop(1,"transparent"),t.fillStyle=u,t.beginPath(),t.arc(o,c,i*1.2,0,Math.PI*2),t.fill();for(let f=0;f<2;f++){const m=Math.sin(n*4+f*Math.PI)*3;t.strokeStyle=`rgba(0, 255, 255, ${.3-f*.1})`,t.lineWidth=2,t.strokeRect(e+m,s,i,a)}}t.restore()}}class _ extends R{constructor(t,e){super(t,e,32,32),this.maxHealth=100,this.health=this.maxHealth,this.damage=6,this.baseArmyCapacity=1,this.armyCapacity=this.baseArmyCapacity,this.maxArmy=this.armyCapacity,this.points=0,this.level=1,this.xp=0,this.experience=0,this.xpToNextLevel=100,this.experienceToNextLevel=100,this.hasHealingUnlocked=!1,this.healingAuraBonus=0,this.healthRegen=0,this.pointsMultiplier=1,this.attackSpeed=.6,this.speed=100,this.inputX=0,this.inputY=0,this.color="#8b00ff",this.glowColor="#bd00ff",this._spriteCache={},this._lastGradientX=-1,this._lastGradientY=-1,this.eventBus=null}updateArmyCapacity(){this.armyCapacity=this.baseArmyCapacity+Math.floor(this.points*1.5),this.maxArmy=this.armyCapacity}setInput(t,e){this.inputX=t,this.inputY=e}update(t){this.healthRegen>0&&(this.health=Math.min(this.maxHealth,this.health+this.healthRegen*t)),this.hasHealingUnlocked?(this.healingAuraRadius=150+(this.healingAuraBonus||0),this.healingPower=5+this.maxHealth*.05):this.healingAuraRadius=0;const e=Math.sqrt(this.inputX*this.inputX+this.inputY*this.inputY);if(e>0){const s=this.inputX/e,i=this.inputY/e;this.vx=s*this.speed,this.vy=i*this.speed}else this.vx=0,this.vy=0;this.x+=this.vx*t,this.y+=this.vy*t}render(t,e=null){const s=e!==null?e:performance.now()/1e3;this.renderHealingAura(t,s),I.renderNigromante(t,this.x,this.y,this.width,this.height,s,this._spriteCache),this.renderHealthBar(t)}renderHealthBar(t){const e=this.width,s=4,i=this.x,a=this.y-10;t.fillStyle="#333",t.fillRect(i,a,e,s);const n=this.maxHealth>0?this.health/this.maxHealth:0;t.fillStyle=n>.5?"#00ff00":n>.25?"#ffaa00":"#ff0000",t.fillRect(i,a,e*n,s)}renderHealingAura(t,e){if(!this.hasHealingUnlocked||!this.healingAuraRadius)return;const s=this.x+this.width/2,i=this.y+this.height/2;t.save();const a=.7+Math.sin(e*3)*.3,n=this.healingAuraRadius*a,r=t.createRadialGradient(s,i,0,s,i,n);r.addColorStop(0,"rgba(138, 43, 226, 0.4)"),r.addColorStop(.7,"rgba(75, 0, 130, 0.2)"),r.addColorStop(1,"rgba(75, 0, 130, 0.05)"),t.fillStyle=r,t.beginPath(),t.arc(s,i,n,0,Math.PI*2),t.fill(),t.strokeStyle=`rgba(138, 43, 226, ${.3*a})`,t.lineWidth=2,t.beginPath(),t.arc(s,i,n,0,Math.PI*2),t.stroke(),t.restore()}applyHealingAura(t,e){if(!this.hasHealingUnlocked||!this.healingAuraRadius||!this.healingPower)return;const s=this.x+this.width/2,i=this.y+this.height/2,a=this.healingAuraRadius*this.healingAuraRadius;for(const n of t){if(!n.active||n.health>=n.maxHealth)continue;const r=n.x+n.width/2,l=n.y+n.height/2;if((r-s)**2+(l-i)**2<=a){const o=this.healingPower*e;n.heal(o)}}}takeDamage(t){this.health-=t,this.health<=0&&(this.health=0,this.active=!1)}heal(t){this.health=Math.min(this.maxHealth,this.health+t)}addExperience(t){const e=t*(this.pointsMultiplier||1);for(this.experience+=e,this.xp=this.experience;this.experience>=this.experienceToNextLevel;)this.levelUp()}levelUp(){this.level++,this.experience=Math.max(0,this.experience-this.experienceToNextLevel),this.experienceToNextLevel=Math.floor(this.experienceToNextLevel*1.5),this.xp=this.experience,this.xpToNextLevel=this.experienceToNextLevel,this.experienceToNextLevel===0&&(this.experienceToNextLevel=100,this.xpToNextLevel=100),this.eventBus&&this.eventBus.emit("player_level_up",{level:this.level,player:this}),console.log(`Â¡Nivel ${this.level} alcanzado!`)}}class N{constructor(){this.keys=new Set,this.handleKeyDown=t=>{t.key&&this.keys.add(t.key.toLowerCase())},this.handleKeyUp=t=>{t.key&&this.keys.delete(t.key.toLowerCase())},window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}isKeyPressed(t){return this.keys.has(t.toLowerCase())}getMovementInput(){let t=0,e=0;return(this.isKeyPressed("w")||this.isKeyPressed("arrowup"))&&(e-=1),(this.isKeyPressed("s")||this.isKeyPressed("arrowdown"))&&(e+=1),(this.isKeyPressed("a")||this.isKeyPressed("arrowleft"))&&(t-=1),(this.isKeyPressed("d")||this.isKeyPressed("arrowright"))&&(t+=1),{x:t,y:e}}isAttackPressed(){return this.isKeyPressed(" ")||this.isKeyPressed("enter")}destroy(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.keys.clear()}}class ${constructor(){this.entities=new Map}register(t,e){this.entities.set(t,e)}get(t){return this.entities.get(t)||[]}update(t,e,...s){const i=this.get(t);for(let a=i.length-1;a>=0;a--){const n=i[a];n.update(e,...s),n.active||i.splice(a,1)}}updateAll(t,...e){for(const[s,i]of this.entities)this.update(s,t,...e)}render(t,e,s=0){this.get(t).forEach(a=>a.render(e,s))}renderAll(t,e=[],s=0){if(e.length===0)for(const[i,a]of this.entities)this.render(i,t,s);else e.forEach(i=>this.render(i,t,s))}clear(t){const e=this.get(t);e.length=0}clearAll(){for(const[t,e]of this.entities)e.length=0}count(t){return this.get(t).length}getAllEntities(){const t=[];for(const[e,s]of this.entities)t.push(...s);return t}}class q{constructor(t,e,s){this.ctx=t,this.width=e,this.height=s,this.gridCanvas=null,this.showGrid=!1,this.gridSize=40}initGrid(){this.gridCanvas=document.createElement("canvas"),this.gridCanvas.width=this.width,this.gridCanvas.height=this.height;const t=this.gridCanvas.getContext("2d");t.strokeStyle="#1a1a1a",t.lineWidth=1,t.beginPath();for(let e=0;e<this.width;e+=this.gridSize)t.moveTo(e,0),t.lineTo(e,this.height);for(let e=0;e<this.height;e+=this.gridSize)t.moveTo(0,e),t.lineTo(this.width,e);t.stroke()}clear(t="#0a0a0a"){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.width,this.height)}renderGrid(){this.showGrid&&(this.gridCanvas||this.initGrid(),this.ctx.drawImage(this.gridCanvas,0,0))}renderUI(t){const{player:e}=t,s=20,i=25;let a=s;this.ctx.fillStyle="#ffffff",this.ctx.font="16px Arial",this.ctx.fillText(`Nivel: ${e.level}`,s,a),a+=i,this.ctx.fillText(`Vida: ${Math.ceil(e.health)}/${e.maxHealth}`,s,a),a+=i,this.ctx.fillText(`EjÃ©rcito: ${t.armyCount}/${e.armyCapacity}`,s,a),a+=i,this.ctx.fillText(`DaÃ±o: ${e.damage}`,s,a),a+=i,this.renderExperienceBar(e,s,a)}renderExperienceBar(t,e,s){this.ctx.fillStyle="#333",this.ctx.fillRect(e,s,200,20);const n=t.experienceToNextLevel>0?t.experience/t.experienceToNextLevel:0;this.ctx.fillStyle="#00aaff",this.ctx.fillRect(e,s,200*n,20),this.ctx.strokeStyle="#555",this.ctx.lineWidth=2,this.ctx.strokeRect(e,s,200,20),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.fillText(`XP: ${Math.floor(t.experience)}/${t.experienceToNextLevel}`,e+200/2,s+14),this.ctx.textAlign="left"}renderDebug(t){const s=this.height-20;this.ctx.fillStyle="#00ff00",this.ctx.font="14px monospace";let i=20;this.ctx.fillText(`FPS: ${t.fps}`,i,s),i+=100,this.ctx.fillText(`Enemigos: ${t.enemyCount}`,i,s),i+=140,this.ctx.fillText(`Proyectiles: ${t.projectileCount}`,i,s),i+=160,this.ctx.fillText(`EjÃ©rcito: ${t.armyCount}`,i,s),i+=120,t.particleCount!==void 0&&this.ctx.fillText(`PartÃ­culas: ${t.particleCount}`,i,s)}renderEntity(t){t.render(this.ctx)}renderEntities(t){t.forEach(e=>this.renderEntity(e))}}class D{constructor(){this.events=new Map}on(t,e){this.events.has(t)||this.events.set(t,[]),this.events.get(t).push(e)}off(t,e){if(!this.events.has(t))return;const s=this.events.get(t),i=s.indexOf(e);i!==-1&&s.splice(i,1)}emit(t,e){if(!this.events.has(t))return;this.events.get(t).forEach(i=>i(e))}clear(){this.events.clear()}}const w={ENEMY_DEFEATED:"enemy_defeated",PLAYER_LEVEL_UP:"player_level_up",PROJECTILE_HIT:"projectile_hit",ARMY_UNIT_ADDED:"army_unit_added",GAME_OVER:"game_over"};class O{constructor(t,e,s=0){this.width=t,this.height=e,this.padding=s}clamp(t){const e=this.padding,s=this.padding,i=this.width-t.width-this.padding,a=this.height-t.height-this.padding;t.x=Math.max(e,Math.min(i,t.x)),t.y=Math.max(s,Math.min(a,t.y))}contains(t){return t.x>=this.padding&&t.y>=this.padding&&t.x+t.width<=this.width-this.padding&&t.y+t.height<=this.height-this.padding}isOutOfBounds(t){return!this.contains(t)}getRandomPosition(t=0,e=0){return{x:this.padding+Math.random()*(this.width-t-this.padding*2),y:this.padding+Math.random()*(this.height-e-this.padding*2)}}}class z extends R{constructor(t,e,s,i,a,n="player"){super(t,e,8,8),this.vx=s,this.vy=i,this.damage=a,this.owner=n,this.speed=400,this.lifetime=3,this.age=0,this.color=n==="player"?"#bd00ff":"#ff0000",this.glowColor=n==="player"?"#8b00ff":"#ff6600",this.trailPositions=[],this.maxTrailLength=5}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.age+=t,this.trailPositions.push({x:this.x,y:this.y}),this.trailPositions.length>this.maxTrailLength&&this.trailPositions.shift(),this.age>=this.lifetime&&(this.active=!1)}render(t){for(let s=0;s<this.trailPositions.length;s++){const i=this.trailPositions[s],a=(s+1)/this.trailPositions.length*.5;t.fillStyle=this.glowColor+Math.floor(a*255).toString(16).padStart(2,"0");const n=this.width*((s+1)/this.trailPositions.length);t.fillRect(i.x-n/2+this.width/2,i.y-n/2+this.height/2,n,n)}const e=t.createRadialGradient(this.x+this.width/2,this.y+this.height/2,0,this.x+this.width/2,this.y+this.height/2,this.width*2);e.addColorStop(0,this.glowColor+"AA"),e.addColorStop(1,"transparent"),t.fillStyle=e,t.fillRect(this.x-this.width,this.y-this.height,this.width*3,this.height*3),t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#ffffff",t.fillRect(this.x+this.width/4,this.y+this.height/4,this.width/2,this.height/2)}isOutOfBounds(t){return t.isOutOfBounds(this)}}class U{constructor(t,e,s){this.player=t,this.projectiles=e,this.eventBus=s,this.attackCooldown=.3,this.timeSinceLastAttack=this.attackCooldown,this.autoAim=!0}update(t,e,s=[]){this.timeSinceLastAttack+=t,e&&this.timeSinceLastAttack>=this.attackCooldown&&(this.attack(s),this.timeSinceLastAttack=0)}attack(t){let e,s;if(this.autoAim&&t.length>0){const r=this.findNearestEnemy(t);r&&(e=r.x+r.width/2,s=r.y+r.height/2)}e===void 0&&(e=this.player.x+100,s=this.player.y);const i=e-(this.player.x+this.player.width/2),a=s-(this.player.y+this.player.height/2),n=Math.sqrt(i*i+a*a);if(n>0){const r=i/n,l=a/n,h=400,o=new z(this.player.x+this.player.width/2-4,this.player.y+this.player.height/2-4,r*h,l*h,this.player.damage,"player");this.projectiles.push(o),this.eventBus&&this.eventBus.emit("player_attack",{projectile:o,player:this.player})}}findNearestEnemy(t){let e=null,s=1/0;const i=this.player.x+this.player.width/2,a=this.player.y+this.player.height/2;for(const n of t){if(!n.active)continue;const r=n.x+n.width/2,l=n.y+n.height/2,h=r-i,o=l-a,c=h*h+o*o;c<s&&(s=c,e=n)}return e}}class F{constructor(t){this.eventBus=t}checkProjectileEnemyCollisions(t,e){const s=[];for(const i of t)if(!(!i.active||i.owner!=="player"))for(const a of e)a.active&&i.collidesWith(a)&&s.push({projectile:i,enemy:a});return s}checkEnemyPlayerCollisions(t,e){const s=[];for(const i of t)i.active&&i.collidesWith(e)&&s.push(i);return s}resolveProjectileEnemyCollisions(t,e){const s=this.checkProjectileEnemyCollisions(t,e),i=[];for(const{projectile:a,enemy:n}of s){if(!a.active||!n.active)continue;a.active=!1,n.takeDamage(a.damage)&&(i.push(n),this.eventBus&&this.eventBus.emit("enemy_defeated",{enemy:n,experience:n.experienceReward})),this.eventBus&&this.eventBus.emit("projectile_hit",{projectile:a,target:n,damage:a.damage})}return i}resolveEnemyPlayerCollisions(t,e,s){const i=this.checkEnemyPlayerCollisions(t,e);for(const a of i)a.attack()&&(e.takeDamage(a.damage),this.eventBus&&this.eventBus.emit("player_damaged",{enemy:a,damage:a.damage,playerHealth:e.health}),e.active||this.eventBus&&this.eventBus.emit("game_over",{player:e,reason:"defeated"}))}resolveEnemyAllyCollisions(t,e,s){for(const i of t)if(i.active){for(const a of e)if(a.active&&i.collidesWith(a)&&i.attack()){const n=a.takeDamage(i.damage);this.eventBus&&this.eventBus.emit("ally_damaged",{enemy:i,ally:a,damage:i.damage,died:n}),n&&i.target===a&&(i.target=null)}}}resolveEnemyProjectileCollisions(t,e,s){for(const i of t)if(!(!i.active||!i.fromEnemy)){if(e.active&&this.checkCircleRectCollision(i.x,i.y,i.width/2,e.x,e.y,e.width,e.height)){i.active=!1,e.takeDamage(i.damage),this.eventBus&&this.eventBus.emit("player_damaged",{damage:i.damage,playerHealth:e.health,source:"shaman_projectile"}),!e.active&&this.eventBus&&this.eventBus.emit("game_over",{player:e,reason:"defeated_by_projectile"});continue}for(const a of s)if(a.active&&this.checkCircleRectCollision(i.x,i.y,i.width/2,a.x,a.y,a.width,a.height)){i.active=!1;const n=a.takeDamage(i.damage);this.eventBus&&this.eventBus.emit("ally_hit",{ally:a,damage:i.damage,died:n,source:"shaman_projectile"});break}}}checkCircleRectCollision(t,e,s,i,a,n,r){const l=Math.max(i,Math.min(t,i+n)),h=Math.max(a,Math.min(e,a+r)),o=t-l,c=e-h;return o*o+c*c<s*s}}class H extends R{constructor(t,e,s="warrior"){const n=28*H.getSizeMultiplier(s);super(t,e,n,n),this.type=s,this.stats=this.getStatsForType(s),this.health=this.stats.health,this.maxHealth=this.stats.health,this.damage=this.stats.damage,this.speed=this.stats.speed,this.experienceReward=this.stats.experience,this.target=null,this.detectionRange=500,this.attackRange=this.stats.attackRange||32,this.attackCooldown=this.stats.attackCooldown||1,this.timeSinceLastAttack=0,this.type==="shaman"&&(this.minDistance=150,this.projectileCooldown=2,this.timeSinceLastProjectile=this.projectileCooldown,this.projectiles=[]),this.color=this.stats.color,this._spriteCache={},this.hue=0}static getSizeMultiplier(t){return{warrior:1,tank:2,shaman:.9,assassin:.8}[t]||1}getStatsForType(t){const e={warrior:{health:30,damage:5,speed:80,experience:10,color:"#4a7832",attackRange:32,attackCooldown:1,description:"Guerrero estÃ¡ndar"},tank:{health:90,damage:8,speed:40,experience:30,color:"#2d4d1f",attackRange:40,attackCooldown:1.5,description:"Tanque pesado"},shaman:{health:25,damage:7,speed:60,experience:25,color:"#6b4423",attackRange:200,attackCooldown:2,projectileSpeed:150,description:"ChamÃ¡n de proyectiles"},assassin:{health:21,damage:6,speed:120,experience:20,color:"#7a9b6c",attackRange:28,attackCooldown:.7,description:"Asesino veloz"}};return e[t]||e.warrior}update(t,e=1280,s=720){this.timeSinceLastAttack+=t,this.type==="shaman"&&(this.timeSinceLastProjectile+=t),this.hue+=t*100,this.hue>360&&(this.hue=0),this.target&&(this.type==="shaman"?this.keepDistance(t,e,s):this.chaseTarget(t,e,s))}chaseTarget(t,e=1280,s=720){if(!this.target||!this.target.active||this.target.health<=0){this.target=null,this.vx=0,this.vy=0;return}const i=this.target.x+this.target.width/2,a=this.target.y+this.target.height/2,n=this.x+this.width/2,r=this.y+this.height/2,l=i-n,h=a-r,o=l*l+h*h,c=this.attackRange*this.attackRange;if(o>c){const d=Math.sqrt(o),g=l/d,p=h/d;this.vx=g*this.speed,this.vy=p*this.speed,this.x+=this.vx*t,this.y+=this.vy*t}else this.vx=0,this.vy=0;this.constrainToBounds(e,s)}setTarget(t){this.target=t}findClosestTarget(t,e){let s=null,i=1/0;const a=this.x+this.width/2,n=this.y+this.height/2;if(t&&t.active){const r=t.x+t.width/2,l=t.y+t.height/2,h=r-a,o=l-n,c=h*h+o*o;c<i&&(i=c,s=t)}if(e&&e.length>0)for(const r of e){if(!r.active)continue;const l=r.x+r.width/2,h=r.y+r.height/2,o=l-a,c=h-n,d=o*o+c*c;d<i&&(i=d,s=r)}s&&this.setTarget(s)}keepDistance(t,e=1280,s=720){if(!this.target||!this.target.active||this.target.health<=0){this.target=null,this.vx=0,this.vy=0;return}const i=this.target.x+this.target.width/2,a=this.target.y+this.target.height/2,n=this.x+this.width/2,r=this.y+this.height/2,l=i-n,h=a-r,o=Math.sqrt(l*l+h*h);if(o<this.minDistance){const c=-l/o,d=-h/o;this.vx=c*this.speed,this.vy=d*this.speed,this.x+=this.vx*t,this.y+=this.vy*t}else if(o>this.attackRange){const c=l/o,d=h/o;this.vx=c*this.speed*.5,this.vy=d*this.speed*.5,this.x+=this.vx*t,this.y+=this.vy*t}else this.vx=0,this.vy=0;this.constrainToBounds(e,s)}shootProjectile(t){if(this.type!=="shaman")return!1;if(!this.target||!this.target.active||this.target.health<=0)return this.target=null,!1;if(this.timeSinceLastProjectile<this.projectileCooldown)return!1;this.timeSinceLastProjectile=0;const e=this.target.x+this.target.width/2,s=this.target.y+this.target.height/2,i=this.x+this.width/2,a=this.y+this.height/2,n=e-i,r=s-a,l=Math.sqrt(n*n+r*r);if(l===0)return!1;const h=n/l,o=r/l,c={x:i,y:a,width:8,height:8,vx:h*this.stats.projectileSpeed,vy:o*this.stats.projectileSpeed,damage:this.damage,active:!0,fromEnemy:!0,owner:this,update(d){this.x+=this.vx*d,this.y+=this.vy*d},render(d){d.fillStyle="#ff4444",d.beginPath(),d.arc(this.x,this.y,this.width/2,0,Math.PI*2),d.fill(),d.fillStyle="rgba(255, 100, 100, 0.5)",d.beginPath(),d.arc(this.x,this.y,this.width,0,Math.PI*2),d.fill()}};return t.push(c),!0}takeDamage(t){return this.health-=t,this.health<=0?(this.health=0,this.active=!1,!0):!1}canAttack(){if(!this.target)return!1;const t=this.target.x+this.target.width/2,e=this.target.y+this.target.height/2,s=this.x+this.width/2,i=this.y+this.height/2,a=t-s,n=e-i;return Math.sqrt(a*a+n*n)<=this.attackRange&&this.timeSinceLastAttack>=this.attackCooldown}attack(){return this.canAttack()?(this.timeSinceLastAttack=0,!0):!1}render(t,e=null){const s=e!==null?e:performance.now()/1e3;I.renderOrc(t,this.x,this.y,this.width,this.height,s,!1,this._spriteCache,this.type),this.renderHealthBar(t)}renderHealthBar(t){const e=this.width,s=3,i=this.x,a=this.y-8;t.fillStyle="#333",t.fillRect(i,a,e,s);const n=this.maxHealth>0?this.health/this.maxHealth:0;t.fillStyle=n>.5?"#ff0000":"#ff6600",t.fillRect(i,a,e*n,s)}}class V{constructor(t,e){this.bounds=t,this.eventBus=e,this.currentWave=0,this.enemiesPerWave=5,this.waveMultiplier=1.3,this.timeBetweenWaves=5,this.timeUntilNextWave=3,this.waveInProgress=!1,this.enemiesSpawnedThisWave=0,this.enemiesToSpawn=0}update(t,e){this.timeUntilNextWave-=t,!this.waveInProgress&&this.timeUntilNextWave<=0&&this.startWave(),this.waveInProgress&&e.length===0&&this.enemiesSpawnedThisWave>=this.enemiesToSpawn&&this.endWave()}startWave(){this.currentWave++,this.waveInProgress=!0,this.enemiesSpawnedThisWave=0,this.enemiesToSpawn=Math.floor(this.enemiesPerWave*Math.pow(this.waveMultiplier,this.currentWave-1)),this.eventBus&&this.eventBus.emit("wave_started",{wave:this.currentWave,enemyCount:this.enemiesToSpawn}),console.log(`ðŸŒŠ Oleada ${this.currentWave} - ${this.enemiesToSpawn} enemigos`)}endWave(){this.waveInProgress=!1,this.timeUntilNextWave=this.timeBetweenWaves,this.eventBus&&this.eventBus.emit("wave_completed",{wave:this.currentWave}),console.log(`âœ… Oleada ${this.currentWave} completada`)}spawnEnemy(t,e){if(!this.waveInProgress||this.enemiesSpawnedThisWave>=this.enemiesToSpawn)return!1;const s=this.getRandomSpawnPosition(),i=this.getEnemyTypeForWave(),a=new H(s.x,s.y,i);return a.setTarget(e),t.push(a),this.enemiesSpawnedThisWave++,!0}getRandomSpawnPosition(){const t=Math.floor(Math.random()*4),e=20;let s,i;switch(t){case 0:s=Math.random()*this.bounds.width,i=-e;break;case 1:s=this.bounds.width+e,i=Math.random()*this.bounds.height;break;case 2:s=Math.random()*this.bounds.width,i=this.bounds.height+e;break;case 3:s=-e,i=Math.random()*this.bounds.height;break}return{x:s,y:i}}getEnemyTypeForWave(){const t=Math.random();return this.currentWave<=2?"warrior":this.currentWave<=5?t<.6?"warrior":"assassin":this.currentWave<=8?t<.4?"warrior":t<.7?"assassin":"shaman":t<.3?"warrior":t<.5?"assassin":t<.75?"shaman":"tank"}getTimeUntilNextWave(){return Math.max(0,this.timeUntilNextWave)}}class W extends R{constructor(t,e,s,i,a=null,n=null,r=null){const o=28*W.getSizeMultiplier(s);super(t,e,o,o),this.originalType=s,this.damage=Math.floor(i.damage*.7),this.speed=i.speed,this.health=i.maxHealth||i.health||30,this.maxHealth=i.maxHealth||i.health||30,this.owner=null,this.target=null,this.followDistance=80,this.detectionRange=400,this.attackRange=32,this.attackCooldown=1.2,this.timeSinceLastAttack=0,this.mode="follow",this.baseColor=i.color||"#4a7832",this.ghostOpacity=.6,this.flickerSpeed=3,this.flickerPhase=Math.random()*Math.PI*2,this.hue=0,this._spriteCache={},this.particleSystem=a,this.particleTimer=0,this.particleInterval=.05,this.armyArray=n,this.separationRadius=40,this.separationForce=80,this.targetX=t,this.targetY=e,this.followDelay=.1+Math.random()*.15,this.smoothing=.08,this._separationCache={x:0,y:0},this.enemyProjectiles=r,this.originalType==="shaman"&&(this.projectileCooldown=1.5,this.timeSinceLastProjectile=0,this.minDistance=100)}static getSizeMultiplier(t){return{warrior:1,tank:2,shaman:.9,assassin:.8}[t]||1}setOwner(t){this.owner=t}update(t){this.timeSinceLastAttack+=t,this.hue+=t*50,this.hue>360&&(this.hue=0),this.particleTimer+=t,this.owner&&(this.target&&this.target.active?(this.mode="attack",this.attackTarget(t)):(this.mode="follow",this.target=null,this.followOwnerWithSeparation(t)),this.spawnEctoplasmTrail())}followOwnerWithSeparation(t){const e=this.owner.x+this.owner.width/2,s=this.owner.y+this.owner.height/2,i=e-this.targetX,a=s-this.targetY;this.targetX+=i*this.smoothing,this.targetY+=a*this.smoothing;const n=this.x+this.width/2,r=this.y+this.height/2,l=this.targetX-n,h=this.targetY-r,o=Math.sqrt(l*l+h*h),c=this.calculateSeparation();if(o>this.followDistance){const d=l/o,g=h/o;this.vx=d*this.speed+c.x,this.vy=g*this.speed+c.y,this.x+=this.vx*t,this.y+=this.vy*t}else this.vx=c.x,this.vy=c.y,this.x+=this.vx*t,this.y+=this.vy*t}calculateSeparation(){if(this._separationCache.x=0,this._separationCache.y=0,!this.armyArray||this.armyArray.length<=1)return this._separationCache;let t=0,e=0,s=0;const i=this.x+this.width/2,a=this.y+this.height/2;for(const n of this.armyArray){if(n===this||!n.active)continue;const r=n.x+n.width/2,l=n.y+n.height/2,h=i-r,o=a-l,c=h*h+o*o,d=this.separationRadius*this.separationRadius;if(c>0&&c<d){const g=Math.sqrt(c),p=this.separationForce*(1-g/this.separationRadius);t+=h/g*p,e+=o/g*p,s++}}return s>0&&(t/=s,e/=s),this._separationCache.x=t,this._separationCache.y=e,this._separationCache}spawnEctoplasmTrail(){var e;if(!(!((e=this.particleSystem)!=null&&e.createTrail)||!(Math.abs(this.vx)>10||Math.abs(this.vy)>10))&&this.particleTimer>=this.particleInterval){this.particleTimer=0;const s=this.x+this.width/2,i=this.y+this.height/2,a=(Math.random()-.5)*this.width,n=(Math.random()-.5)*this.height;this.particleSystem.createTrail(s+a,i+n,"#00ffff")}}attackTarget(t){if(!this.target||!this.target.active){this.target=null,this.vx=0,this.vy=0;return}if(this.originalType==="shaman"){this.shaman_attackRanged(t);return}const e=this.target.x+this.target.width/2,s=this.target.y+this.target.height/2,i=this.x+this.width/2,a=this.y+this.height/2,n=e-i,r=s-a,l=n*n+r*r,h=this.attackRange*this.attackRange;if(l>h){const o=Math.sqrt(l),c=n/o,d=r/o;this.vx=c*this.speed,this.vy=d*this.speed,this.x+=this.vx*t,this.y+=this.vy*t}else if(this.vx=0,this.vy=0,this.timeSinceLastAttack>=this.attackCooldown){const o=this.target.takeDamage(this.damage);this.timeSinceLastAttack=0,o&&(this.target=null)}}shaman_attackRanged(t){if(!this.target||!this.target.active){this.target=null,this.vx=0,this.vy=0;return}const e=this.target.x+(this.target.width||0)/2,s=this.target.y+(this.target.height||0)/2,i=this.x+(this.width||0)/2,a=this.y+(this.height||0)/2,n=e-i,r=s-a,l=Math.sqrt(n*n+r*r);if(!isFinite(l)||l<0){this.vx=0,this.vy=0;return}if(l<(this.minDistance||100)){const h=-n/(l||1),o=-r/(l||1);this.vx=h*(this.speed||60)*.5,this.vy=o*(this.speed||60)*.5}else if(l>(this.detectionRange||400)){this.target=null,this.vx=0,this.vy=0;return}else this.vx=0,this.vy=0;this.x+=this.vx*t,this.y+=this.vy*t}shootProjectile(){if(!this.target||!this.target.active){this.target=null;return}}findNearestEnemy(t){let e=null,s=1/0;const i=this.x+this.width/2,a=this.y+this.height/2;for(const n of t){if(!n.active)continue;const r=n.x+n.width/2,l=n.y+n.height/2,h=r-i,o=l-a,c=Math.sqrt(h*h+o*o);c<s&&c<this.detectionRange&&(s=c,e=n)}this.target=e}heal(t){this.active&&(this.health=Math.min(this.maxHealth,this.health+t))}takeDamage(t){return this.active?(this.health-=t,this.health<=0?(this.health=0,this.die(),!0):!1):!1}die(){if(this.active=!1,this.particleSystem){const t=this.x+this.width/2,e=this.y+this.height/2;this.particleSystem.createExplosion(t,e,{count:20,color:"#00ffff",speed:100,size:3});for(let s=0;s<8;s++){const i=s/8*Math.PI*2,a=Math.cos(i)*15,n=Math.sin(i)*15;this.particleSystem.createTrail(t+a,e+n,"#0099ff")}}}render(t,e=null){const s=e!==null?e:performance.now()/1e3;I.renderOrc(t,this.x,this.y,this.width,this.height,s,!0,this._spriteCache,this.originalType),this.renderHealthBar(t)}renderHealthBar(t){if(this.health>=this.maxHealth)return;const e=this.width,s=2,i=this.x,a=this.y-6;t.fillStyle="rgba(0, 0, 0, 0.4)",t.fillRect(i,a,e,s);const n=this.maxHealth>0?this.health/this.maxHealth:0;let r;n>.6?r="#00ffff":n>.3?r="#0099ff":r="#6600ff",t.fillStyle=r,t.fillRect(i,a,e*n,s),t.fillStyle=`rgba(255, 255, 255, ${.3*n})`,t.fillRect(i,a,e*n*.5,s*.5)}}class K{constructor(t={}){this.enabled=t.enabled!==!1,this.quality=t.quality||"high",this.qualitySettings={low:{vignetteRadius:.6,glowSamples:2,lightningSegments:3,vignetteStrength:.2},medium:{vignetteRadius:.5,glowSamples:4,lightningSegments:5,vignetteStrength:.3},high:{vignetteRadius:.4,glowSamples:6,lightningSegments:8,vignetteStrength:.3}},this.chromaticAberration=0,this.glowEnabled=!0}applyVignette(t,e,s){if(!this.enabled)return;const i=this.qualitySettings[this.quality],a=t.createRadialGradient(e/2,s/2,e*.3,e/2,s/2,e*.7);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(1,`rgba(0, 0, 0, ${i.vignetteStrength})`),t.fillStyle=a,t.fillRect(0,0,e,s)}drawGlow(t,e,s,i,a,n=.5){if(!this.enabled||!this.glowEnabled)return;const l=this.qualitySettings[this.quality].glowSamples,h=a.replace("#",""),o=parseInt(h.substr(0,2),16),c=parseInt(h.substr(2,2),16),d=parseInt(h.substr(4,2),16);t.save();for(let g=0;g<l;g++){const p=i*(1+g*.3),b=n*(1-g/l),S=t.createRadialGradient(e,s,0,e,s,p);S.addColorStop(0,`rgba(${o}, ${c}, ${d}, ${b})`),S.addColorStop(.5,`rgba(${o}, ${c}, ${d}, ${b*.3})`),S.addColorStop(1,`rgba(${o}, ${c}, ${d}, 0)`),t.fillStyle=S,t.fillRect(e-p,s-p,p*2,p*2)}t.restore()}drawDistortion(t,e,s,i,a,n,r){if(!this.enabled)return;const l=t.getImageData(Math.max(0,e-i),Math.max(0,s-i),Math.min(i*2,n),Math.min(i*2,r));t.save(),t.globalAlpha=.8,t.putImageData(l,e-i+a*2,s-i),t.globalAlpha=1,t.restore()}drawLightning(t,e,s,i,a,n,r){if(!this.enabled)return;const h=this.qualitySettings[this.quality].lightningSegments,o=15;t.save(),t.strokeStyle=n||"#00ffff",t.lineWidth=r||2,t.lineCap="round",t.beginPath(),t.moveTo(e,s);const c=i-e,d=a-s,g=[{x:e,y:s}];for(let p=1;p<h;p++){const b=p/h,S=e+c*b+(Math.random()-.5)*o,k=s+d*b+(Math.random()-.5)*o;g.push({x:S,y:k}),t.lineTo(S,k)}t.lineTo(i,a),t.stroke(),t.strokeStyle="#ffffff",t.lineWidth=(r||2)*.3,t.beginPath(),t.moveTo(e,s);for(const p of g)t.lineTo(p.x,p.y);t.lineTo(i,a),t.stroke(),t.restore()}getScreenShake(t){if(!this.enabled)return{x:0,y:0};const e=t||1;return{x:(Math.random()-.5)*e*4,y:(Math.random()-.5)*e*4}}drawEnergyRing(t,e,s,i,a,n){if(!this.enabled)return;const l=1-i/a;t.save(),t.strokeStyle=(n||"#8b00ff")+Math.floor(l*255).toString(16).padStart(2,"0"),t.lineWidth=3,t.beginPath(),t.arc(e,s,i,0,Math.PI*2),t.stroke(),t.restore()}applyGhostFilter(t,e,s){this.enabled&&(t.save(),t.globalCompositeOperation="screen",t.fillStyle="rgba(0, 200, 255, 0.1)",t.fillRect(0,0,e,s),t.globalCompositeOperation="source-over",t.restore())}setQuality(t){this.qualitySettings[t]&&(this.quality=t)}setEnabled(t){this.enabled=t}setGlowEnabled(t){this.glowEnabled=t}}class J{constructor(t,e){this.width=t,this.height=e,this.showCardSelection=!1,this.selectedCard=null,this.availableCards=[],this.cardWidth=200,this.cardHeight=280,this.cardSpacing=30,this.cardRadius=10,this.cardHoverIndex=-1,this.hoverScale=1,this.hoverTargetScale=1,this.colors={cardBg:"#1a1a2e",cardBorder:"#bd00ff",cardHover:"#ff00ff",textPrimary:"#ffffff",textSecondary:"#aaaaaa",rarityCommon:"#7f8c8d",rarityRare:"#3498db",rarityEpic:"#9b59b6",rarityLegendary:"#f39c12"}}update(t){this.hoverScale+=(this.hoverTargetScale-this.hoverScale)*10*t}render(t,e){this.renderHUD(t,e.player,e.armyCount),this.showCardSelection&&this.renderCardSelection(t)}renderHUD(t,e,s){t.save(),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,this.width,80),t.fillStyle=this.colors.textPrimary,t.font="bold 24px Arial",t.fillText(`Nivel ${e.level}`,20,35);const r=20,l=45,h=e.xp/e.xpToNextLevel;t.fillStyle="rgba(255, 255, 255, 0.2)",this.roundRect(t,r,l,200,25,5,!0,!1),t.fillStyle="#bd00ff",this.roundRect(t,r,l,200*h,25,5,!0,!1),t.fillStyle=this.colors.textPrimary,t.font="14px Arial",t.fillText(`XP: ${Math.floor(e.xp)}/${e.xpToNextLevel}`,r+5,l+17);const o=200+20*2+20,c=45,d=e.health/e.maxHealth;t.fillStyle="rgba(255, 255, 255, 0.2)",this.roundRect(t,o,c,200,25,5,!0,!1);const g=d>.5?"#00ff00":d>.25?"#ffaa00":"#ff0000";t.fillStyle=g,this.roundRect(t,o,c,200*d,25,5,!0,!1),t.fillStyle=this.colors.textPrimary,t.font="14px Arial",t.fillText(`HP: ${Math.floor(e.health)}/${e.maxHealth}`,o+5,c+17);const p=this.width-20;t.font="bold 24px Arial",t.fillStyle="#00ffff",t.textAlign="right",t.fillText(`ðŸ‘» ${s}/${e.maxArmy}`,p,35),t.font="16px Arial",t.fillStyle=this.colors.textSecondary,t.fillText(`Puntos: ${Math.floor(e.points)}`,p,60),t.textAlign="left",t.restore()}renderCardSelection(t){t.save(),t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,this.width,this.height),t.fillStyle=this.colors.textPrimary,t.font="bold 48px Arial",t.textAlign="center",t.fillText("Â¡NIVEL SUBIDO!",this.width/2,120),t.font="24px Arial",t.fillStyle=this.colors.textSecondary,t.fillText("Selecciona una mejora:",this.width/2,170);const e=this.availableCards.length*(this.cardWidth+this.cardSpacing)-this.cardSpacing,s=(this.width-e)/2,i=220;for(let a=0;a<this.availableCards.length;a++){const n=this.availableCards[a],r=s+a*(this.cardWidth+this.cardSpacing),l=i,h=a===this.cardHoverIndex?this.hoverScale:1,o=a===this.cardHoverIndex?-20:0;this.renderCard(t,n,r,l+o,h,a===this.cardHoverIndex)}t.textAlign="left",t.restore()}renderCard(t,e,s,i,a,n){t.save();const r=s+this.cardWidth/2,l=i+this.cardHeight/2;t.translate(r,l),t.scale(a,a),t.translate(-r,-l),n&&(t.shadowBlur=30,t.shadowColor=this.colors.cardHover),t.fillStyle=this.colors.cardBg,this.roundRect(t,s,i,this.cardWidth,this.cardHeight,this.cardRadius,!0,!1),t.strokeStyle=n?this.colors.cardHover:this.colors.cardBorder,t.lineWidth=n?4:2,this.roundRect(t,s,i,this.cardWidth,this.cardHeight,this.cardRadius,!1,!0);const h=this.colors[`rarity${e.rarity}`]||this.colors.rarityCommon;t.fillStyle=h,this.roundRect(t,s,i,this.cardWidth,40,this.cardRadius,!0,!1),t.fillStyle=this.colors.textPrimary,t.font="bold 18px Arial",t.textAlign="center",t.fillText(e.name,s+this.cardWidth/2,i+27),t.font="64px Arial",t.fillText(e.icon,s+this.cardWidth/2,i+120),t.font="14px Arial",t.fillStyle=this.colors.textSecondary;const o=this.wrapText(e.description,this.cardWidth-20);for(let c=0;c<o.length;c++)t.fillText(o[c],s+this.cardWidth/2,i+160+c*20);t.font="bold 24px Arial",t.fillStyle=e.valueColor||"#00ff00",t.fillText(e.value,s+this.cardWidth/2,i+this.cardHeight-30),t.textAlign="left",t.restore()}wrapText(t,e){const s=t.split(" "),i=[];let a="";for(const n of s){const r=a+(a?" ":"")+n;r.length*8>e?(a&&i.push(a),a=n):a=r}return a&&i.push(a),i}roundRect(t,e,s,i,a,n,r,l){t.beginPath(),t.moveTo(e+n,s),t.lineTo(e+i-n,s),t.quadraticCurveTo(e+i,s,e+i,s+n),t.lineTo(e+i,s+a-n),t.quadraticCurveTo(e+i,s+a,e+i-n,s+a),t.lineTo(e+n,s+a),t.quadraticCurveTo(e,s+a,e,s+a-n),t.lineTo(e,s+n),t.quadraticCurveTo(e,s,e+n,s),t.closePath(),r&&t.fill(),l&&t.stroke()}handleCardClick(t,e){if(!this.showCardSelection)return null;const s=this.availableCards.length*(this.cardWidth+this.cardSpacing)-this.cardSpacing,i=(this.width-s)/2,a=220;for(let n=0;n<this.availableCards.length;n++){const r=i+n*(this.cardWidth+this.cardSpacing),l=a+(n===this.cardHoverIndex?-20:0);if(t>=r&&t<=r+this.cardWidth&&e>=l&&e<=l+this.cardHeight)return this.availableCards[n]}return null}handleCardHover(t,e){if(!this.showCardSelection){this.cardHoverIndex=-1;return}const s=this.availableCards.length*(this.cardWidth+this.cardSpacing)-this.cardSpacing,i=(this.width-s)/2,a=220;let n=!1;for(let r=0;r<this.availableCards.length;r++){const l=i+r*(this.cardWidth+this.cardSpacing),h=a;if(t>=l&&t<=l+this.cardWidth&&e>=h&&e<=h+this.cardHeight){this.cardHoverIndex=r,this.hoverTargetScale=1.1,n=!0;break}}n||(this.cardHoverIndex=-1,this.hoverTargetScale=1)}showCards(t){this.availableCards=t,this.showCardSelection=!0,this.cardHoverIndex=-1}hideCards(){this.showCardSelection=!1,this.availableCards=[],this.cardHoverIndex=-1}}class Q{constructor(t){this.eventBus=t,this.cardLibrary=[{id:"damage_1",name:"Fuego Oscuro",description:"Aumenta el daÃ±o de tus proyectiles",icon:"ðŸ”¥",rarity:"Common",type:"damage",value:"+5 DaÃ±o",valueColor:"#ff6600",effect:e=>{e.damage+=5}},{id:"damage_2",name:"Llamas Infernales",description:"Gran aumento de daÃ±o",icon:"ðŸ’¥",rarity:"Rare",type:"damage",value:"+15 DaÃ±o",valueColor:"#ff0000",effect:e=>{e.damage+=15}},{id:"army_1",name:"Llamado Espectral",description:"Aumenta tu capacidad de ejÃ©rcito",icon:"ðŸ‘»",rarity:"Common",type:"army",value:"+3 Aliados",valueColor:"#00ffff",effect:e=>{e.baseArmyCapacity+=3,e.updateArmyCapacity()}},{id:"army_2",name:"LegiÃ³n de Sombras",description:"Gran aumento de capacidad de ejÃ©rcito",icon:"ðŸ‘¥",rarity:"Epic",type:"army",value:"+8 Aliados",valueColor:"#00aaff",effect:e=>{e.baseArmyCapacity+=8,e.updateArmyCapacity()}},{id:"health_1",name:"Vigor NecrÃ³tico",description:"Aumenta tu vida mÃ¡xima",icon:"â¤ï¸",rarity:"Common",type:"health",value:"+25 Vida",valueColor:"#00ff00",effect:e=>{e.maxHealth+=25,e.health=Math.min(e.health+25,e.maxHealth)}},{id:"health_2",name:"Esencia Vital",description:"Restaura y aumenta vida",icon:"ðŸ’š",rarity:"Rare",type:"health",value:"+50 Vida",valueColor:"#00ff00",effect:e=>{e.maxHealth+=50,e.health=e.maxHealth}},{id:"speed_1",name:"FrenesÃ­",description:"Aumenta velocidad de ataque",icon:"âš¡",rarity:"Common",type:"attackSpeed",value:"+20% Velocidad",valueColor:"#ffff00",effect:e=>{e.attackSpeed*=.8}},{id:"speed_2",name:"Tormenta Arcana",description:"Gran aumento de velocidad de ataque",icon:"âš¡âš¡",rarity:"Epic",type:"attackSpeed",value:"+40% Velocidad",valueColor:"#ffaa00",effect:e=>{e.attackSpeed*=.6}},{id:"move_1",name:"Paso Fantasma",description:"Aumenta velocidad de movimiento",icon:"ðŸ’¨",rarity:"Common",type:"movement",value:"+15% Velocidad",valueColor:"#aaaaff",effect:e=>{e.speed*=1.15}},{id:"move_2",name:"Viento Espectral",description:"Gran aumento de velocidad",icon:"ðŸŒªï¸",rarity:"Rare",type:"movement",value:"+30% Velocidad",valueColor:"#8888ff",effect:e=>{e.speed*=1.3}},{id:"special_1",name:"Cosecha de Almas",description:"Los enemigos dan mÃ¡s puntos",icon:"âœ¨",rarity:"Epic",type:"special",value:"+50% Puntos",valueColor:"#bd00ff",effect:e=>{e.pointsMultiplier=(e.pointsMultiplier||1)*1.5}},{id:"special_2",name:"RegeneraciÃ³n",description:"Regenera vida con el tiempo",icon:"ðŸ”‹",rarity:"Legendary",type:"special",value:"+2 Vida/seg",valueColor:"#f39c12",effect:e=>{e.healthRegen=(e.healthRegen||0)+2}},{id:"special_3",name:"Poder Definitivo",description:"Mejora mÃºltiples stats",icon:"ðŸ‘‘",rarity:"Legendary",type:"special",value:"Todo +10%",valueColor:"#ffd700",effect:e=>{e.damage=Math.floor(e.damage*1.1),e.maxHealth=Math.floor(e.maxHealth*1.1),e.speed*=1.1,e.attackSpeed*=.9,e.baseArmyCapacity+=2,e.updateArmyCapacity()}},{id:"healing_unlock",name:"Despertar Sangriento",description:"Desbloquea tu aura de curaciÃ³n para aliados",icon:"ðŸ©¸",rarity:"Epic",type:"special",value:"Aura Desbloqueada",valueColor:"#ff00ff",conditions:e=>!e.hasHealingUnlocked,effect:e=>{e.hasHealingUnlocked=!0,console.log("âœ¨ Aura de curaciÃ³n desbloqueada")}},{id:"healing_range",name:"VÃ­nculo Vital",description:"Expande el rango de tu aura de curaciÃ³n",icon:"ðŸ’œ",rarity:"Rare",type:"special",value:"+40 Rango",valueColor:"#ff00ff",conditions:e=>e.hasHealingUnlocked,effect:e=>{e.healingAuraBonus||(e.healingAuraBonus=0),e.healingAuraBonus+=40,console.log("ðŸ’œ Rango del aura expandido")}},{id:"master_souls",name:"Maestro de Almas",description:"Aumenta tu capacidad de invocaciÃ³n",icon:"âšœï¸",rarity:"Epic",type:"army",value:"+2 Aliados",valueColor:"#00ffff",effect:e=>{e.baseArmyCapacity+=2,e.updateArmyCapacity(),console.log("âšœï¸ Capacidad de ejÃ©rcito aumentada")}}],this.rarityWeights={Common:60,Rare:25,Epic:12,Legendary:3}}generateCards(t,e,s=null){const i=[],a=new Set,n={...this.rarityWeights};for(e>=5&&(n.Common=45,n.Rare=35,n.Epic=15,n.Legendary=5),e>=10&&(n.Common=30,n.Rare=40,n.Epic=20,n.Legendary=10);i.length<t;){const r=this.selectRarity(n),l=this.cardLibrary.filter(h=>{const o=!a.has(h.id),c=h.rarity===r,d=!h.conditions||s&&h.conditions(s);return o&&c&&d});if(l.length>0){const h=l[Math.floor(Math.random()*l.length)];i.push({...h}),a.add(h.id)}else break}return i}selectRarity(t){const e=Object.values(t).reduce((i,a)=>i+a,0);let s=Math.random()*e;for(const[i,a]of Object.entries(t))if(s-=a,s<=0)return i;return"Common"}applyCard(t,e){t.effect&&t.effect(e),this.eventBus.emit("CARD_APPLIED",{card:t,player:e})}}class Z{constructor(t){if(this.canvas=t,this.ctx=t.getContext("2d"),!this.ctx)throw new Error("No se pudo obtener el contexto 2D del canvas");this.width=t.width,this.height=t.height,this.inputManager=new N,this.entityManager=new $,this.renderer=new q(this.ctx,this.width,this.height),this.eventBus=new D,this.bounds=new O(this.width,this.height),this.particleSystem=new L({maxParticles:800,enabled:!0}),this.shaderEffects=new K({quality:"high",enabled:!0}),this.uiManager=new J(this.width,this.height),this.cardSystem=new Q(this.eventBus),this.player=new _(this.width/2,this.height/2),this.player.eventBus=this.eventBus,this.enemies=[],this.army=[],this.projectiles=[],this.enemyProjectiles=[],this.attackController=new U(this.player,this.projectiles,this.eventBus),this.collisionSystem=new F(this.eventBus),this.waveManager=new V(this.bounds,this.eventBus),this.enemySpawnCooldown=.5,this.timeSinceLastSpawn=0,this.entityManager.register("enemies",this.enemies),this.entityManager.register("army",this.army),this.entityManager.register("projectiles",this.projectiles),this.entityManager.register("enemyProjectiles",this.enemyProjectiles),this.running=!1,this.paused=!1,this.lastTime=0,this.gameTime=0,this.fps=0,this.frameCount=0,this.lastFpsUpdate=0,this.mouseX=0,this.mouseY=0,this.showDebug=!0,this.setupEventListeners(),this.setupMouseListeners()}setupEventListeners(){this.eventBus.on(w.PLAYER_LEVEL_UP,t=>{console.log(`Â¡Nivel ${t.level} alcanzado!`),this.particleSystem.createExplosion(t.player.x+t.player.width/2,t.player.y+t.player.height/2,{count:30,color:"#8b00ff",speed:150,size:6}),this.pauseForCards(t.level)}),this.eventBus.on(w.ENEMY_DEFEATED,t=>{this.player.addExperience(t.experience||10),this.particleSystem.createExplosion(t.enemy.x+t.enemy.width/2,t.enemy.y+t.enemy.height/2,{count:12,color:t.enemy.color,speed:120,size:4}),this.army.length<this.player.armyCapacity&&this.convertEnemyToAlly(t.enemy)}),this.eventBus.on(w.PROJECTILE_HIT,t=>{this.particleSystem.createImpact(t.target.x+t.target.width/2,t.target.y+t.target.height/2,t.projectile.vx,t.projectile.vy)}),this.eventBus.on(w.GAME_OVER,t=>{console.log("âŒ Game Over"),this.stop()})}start(){this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime)}stop(){this.running=!1}loop(t){if(!this.running)return;const e=(t-this.lastTime)/1e3;this.lastTime=t,this.updateFPS(t),this.update(e),this.render(),requestAnimationFrame(s=>this.loop(s))}updateFPS(t){this.frameCount++,t-this.lastFpsUpdate>=1e3&&(this.fps=this.frameCount,this.frameCount=0,this.lastFpsUpdate=t)}update(t){if(this.paused){this.uiManager.update(t);return}this.gameTime+=t,t=Math.min(t,.1),this.waveManager.update(t,this.enemies),this.timeSinceLastSpawn+=t,this.timeSinceLastSpawn>=this.enemySpawnCooldown&&this.waveManager.spawnEnemy(this.enemies,this.player)&&(this.timeSinceLastSpawn=0);const e=this.inputManager.getMovementInput();this.player.setInput(e.x,e.y);const s=this.inputManager.isAttackPressed();this.attackController.update(t,s,this.enemies),this.player.update(t),this.bounds.clamp(this.player),this.enemies.forEach(a=>{a.findClosestTarget(this.player,this.army),a.type==="shaman"&&a.active&&a.shootProjectile(this.enemyProjectiles)}),this.army.forEach(a=>{a.mode==="follow"&&this.enemies.length>0&&a.findNearestEnemy(this.enemies)}),this.entityManager.update("army",t),this.entityManager.update("enemies",t,this.width,this.height),this.entityManager.update("projectiles",t),this.entityManager.update("enemyProjectiles",t);for(let a=this.projectiles.length-1;a>=0;a--)this.bounds.isOutOfBounds(this.projectiles[a])&&(this.projectiles[a].active=!1);for(let a=this.enemyProjectiles.length-1;a>=0;a--)this.bounds.isOutOfBounds(this.enemyProjectiles[a])&&(this.enemyProjectiles[a].active=!1);this.army.forEach(a=>this.bounds.clamp(a)),this.collisionSystem.resolveProjectileEnemyCollisions(this.projectiles,this.enemies),this.collisionSystem.resolveEnemyPlayerCollisions(this.enemies,this.player,t),this.collisionSystem.resolveEnemyAllyCollisions(this.enemies,this.army,t),this.collisionSystem.resolveEnemyProjectileCollisions(this.enemyProjectiles,this.player,this.army),this.particleSystem.update(t),this.frameCount++;let i=0;for(let a=this.army.length-1;a>=0;a--)(!this.army[a].active||this.army[a].health<=0)&&(this.army.splice(a,1),i++);i>0&&this.frameCount%30===0&&console.log(`ðŸ§¹ GC: ${i} aliado(s) eliminado(s) - Contador real: ${this.army.length}/${this.player.armyCapacity}`),this.uiManager.update(t),this.player.applyHealingAura(this.army,t),(this.player.vx!==0||this.player.vy!==0)&&this.particleSystem.createTrail(this.player.x+this.player.width/2,this.player.y+this.player.height/2,"#bd00ff")}convertEnemyToAlly(t){t.active=!1;const e=new W(t.x,t.y,t.type,{health:t.maxHealth,maxHealth:t.maxHealth,damage:t.damage,speed:t.speed,color:t.color},this.particleSystem,this.army,this.enemyProjectiles);e.setOwner(this.player),this.army.push(e),this.particleSystem.createGhostConversion(t.x+t.width/2,t.y+t.height/2),this.player.updateArmyCapacity(),this.eventBus.emit(w.ARMY_UNIT_ADDED,{ally:e,armySize:this.army.length}),console.log(`ðŸ‘» Aliado invocado (${this.army.length}/${this.player.armyCapacity})`)}render(){this.renderer.clear(),this.renderer.showGrid=this.showDebug,this.renderer.renderGrid(),this.particleSystem.render(this.ctx);const t=["projectiles","enemyProjectiles","army","enemies"];this.entityManager.renderAll(this.ctx,t,this.gameTime),this.player.render(this.ctx,this.gameTime),this.shaderEffects.applyVignette(this.ctx,this.width,this.height),this.uiManager.render(this.ctx,{player:this.player,armyCount:this.army.length}),this.showDebug&&this.renderer.renderDebug({fps:this.fps,enemyCount:this.enemies.length,projectileCount:this.projectiles.length,enemyProjectileCount:this.enemyProjectiles.length,armyCount:this.army.length,particleCount:this.particleSystem.getCount()})}setupMouseListeners(){this.mouseMoveListener=t=>{const e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top,this.uiManager.showCardSelection&&this.uiManager.handleCardHover(this.mouseX,this.mouseY)},this.mouseClickListener=t=>{const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.handleCardClick(s,i)},this.canvas.addEventListener("mousemove",this.mouseMoveListener),this.canvas.addEventListener("click",this.mouseClickListener)}pauseForCards(t){this.paused=!0;const e=this.cardSystem.generateCards(3,t,this.player);this.uiManager.showCards(e),console.log("ðŸŽ´ Selector de cartas activado")}handleCardClick(t,e){if(!this.paused)return;const s=this.uiManager.handleCardClick(t,e);s?(console.log(`âœ… Carta seleccionada: ${s.name}`),this.cardSystem.applyCard(s,this.player),this.particleSystem.createExplosion(this.player.x+this.player.width/2,this.player.y+this.player.height/2,{count:25,color:"#bd00ff",speed:140,size:5}),this.uiManager.hideCards(),this.paused=!1):console.log("âš ï¸ Click fuera de cartas - presiona dentro de una carta para seleccionarla")}destroy(){this.stop();const t=this.mouseMoveListener,e=this.mouseClickListener;t&&this.canvas.removeEventListener("mousemove",t),e&&this.canvas.removeEventListener("click",e),this.eventBus&&this.eventBus.clear(),this.inputManager&&this.inputManager.destroy(),console.log("ðŸ§¹ Game destruido y listeners limpiados")}}class x extends E{constructor(){super(),this.game=null}enter(t={}){console.log("ðŸŽ® Iniciando partida..."),this.sceneManager.pauseLoop(),this.game=new Z(this.canvas),this.game.eventBus.on("game_over",e=>{this.handleGameOver(e)}),this.game.start()}exit(){console.log("ðŸ‘‹ Saliendo del juego..."),this.game&&(this.game.stop(),this.game.destroy(),this.game=null),this.sceneManager.resumeLoop()}handleGameOver(t){if(console.log("ðŸ’€ Juego terminado, cambiando a Game Over..."),this.game){this.game.stop();const e={level:this.game.player.level,kills:this.game.player.points,armySize:this.game.army.length,wave:this.game.waveManager.currentWave,playerHealth:this.game.player.health};this.sceneManager.switchTo("gameover",e)}}update(t){}render(){}}class tt extends E{constructor(){super(),this.gameStats={level:0,kills:0,armySize:0,wave:0,score:0},this.particleSystem=null,this.menuButton={x:0,y:0,width:280,height:70,text:"MENÃš PRINCIPAL",hovered:!1,scale:1,targetScale:1},this.fadeIn=0,this.titleShake=0,this.mouseX=0,this.mouseY=0,this.mouseMoveListener=null,this.mouseClickListener=null}enter(t={}){console.log("ðŸ’€ Game Over"),this.transitioning=!1,this.gameStats={level:t.level||0,kills:t.kills||0,armySize:t.armySize||0,wave:t.wave||0,score:this.calculateScore(t)},this.particleSystem=new L({maxParticles:300,enabled:!0}),this.menuButton.x=this.width/2-this.menuButton.width/2,this.menuButton.y=this.height-150,this.canvasBounds=this.canvas.getBoundingClientRect(),this.cacheGradients(),this.fadeIn=0,this.setupMouseListeners(),this.spawnDeathExplosion()}exit(){this.mouseMoveListener&&(this.canvas.removeEventListener("mousemove",this.mouseMoveListener),this.mouseMoveListener=null),this.mouseClickListener&&(this.canvas.removeEventListener("click",this.mouseClickListener),this.mouseClickListener=null),this.particleSystem&&(this.particleSystem.clear(),this.particleSystem=null),this.canvasBounds=null,this.backgroundGradient=null,this.titleGradient=null,this.buttonGradientNormal=null,this.buttonGradientHover=null}calculateScore(t){return(t.level||0)*100+(t.kills||0)*10+(t.armySize||0)*5+(t.wave||0)*50}setupMouseListeners(){this.mouseMoveListener=t=>{this.mouseX=t.clientX-this.canvasBounds.left,this.mouseY=t.clientY-this.canvasBounds.top,this.checkButtonHover()},this.mouseClickListener=t=>{const e=t.clientX-this.canvasBounds.left,s=t.clientY-this.canvasBounds.top;this.isPointInButton(e,s)&&this.returnToMenu()},this.canvas.addEventListener("mousemove",this.mouseMoveListener),this.canvas.addEventListener("click",this.mouseClickListener)}checkButtonHover(){const t=this.menuButton.hovered;this.menuButton.hovered=this.isPointInButton(this.mouseX,this.mouseY),this.menuButton.hovered!==t&&(this.menuButton.targetScale=this.menuButton.hovered?1.1:1,this.menuButton.hovered&&this.particleSystem.createExplosion(this.menuButton.x+this.menuButton.width/2,this.menuButton.y+this.menuButton.height/2,{count:8,color:"#ff6600",speed:80,size:3,lifetime:.6}))}isPointInButton(t,e){return t>=this.menuButton.x&&t<=this.menuButton.x+this.menuButton.width&&e>=this.menuButton.y&&e<=this.menuButton.y+this.menuButton.height}returnToMenu(){this.transitioning||(this.transitioning=!0,console.log("ðŸ”™ Volviendo al menÃº..."),this.particleSystem.createExplosion(this.menuButton.x+this.menuButton.width/2,this.menuButton.y+this.menuButton.height/2,{count:20,color:"#ff6600",speed:120,size:4}),setTimeout(()=>{this.sceneManager.switchTo("menu")},200))}spawnDeathExplosion(){for(let t=0;t<30;t++){const e=Math.PI*2*t/30,s=100+Math.random()*150,i=this.width/2,a=this.height/2-100,n=this.particleSystem.getParticle();n&&(n.init(i,a,Math.cos(e)*s,Math.sin(e)*s,3+Math.random()*4,Math.random()>.5?"#ff0000":"#ff6600",1.5,150),this.particleSystem.particles.push(n))}}update(t){this.fadeIn=Math.min(1,this.fadeIn+t*2),this.fadeIn<.5?this.titleShake=(Math.random()-.5)*10*(1-this.fadeIn*2):this.titleShake=0;const e=8;this.menuButton.scale+=(this.menuButton.targetScale-this.menuButton.scale)*e*t,this.particleSystem.update(t)}cacheGradients(){this.backgroundGradient=this.ctx.createRadialGradient(this.width/2,this.height/2,0,this.width/2,this.height/2,this.width),this.backgroundGradient.addColorStop(0,"#2a0a0a"),this.backgroundGradient.addColorStop(.5,"#1a0a0a"),this.backgroundGradient.addColorStop(1,"#0a0a0a"),this.titleGradient=this.ctx.createLinearGradient(this.width/2-300,0,this.width/2+300,0),this.titleGradient.addColorStop(0,"#ff6600"),this.titleGradient.addColorStop(.5,"#ff0000"),this.titleGradient.addColorStop(1,"#ff6600");const t=this.menuButton;this.buttonGradientNormal=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height),this.buttonGradientNormal.addColorStop(0,"#cc5200"),this.buttonGradientNormal.addColorStop(1,"#993d00"),this.buttonGradientHover=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height),this.buttonGradientHover.addColorStop(0,"#ff6600"),this.buttonGradientHover.addColorStop(1,"#cc5200")}render(){this.ctx.fillStyle=this.backgroundGradient,this.ctx.fillRect(0,0,this.width,this.height),this.particleSystem.render(this.ctx),this.ctx.fillStyle=`rgba(0, 0, 0, ${1-this.fadeIn})`,this.ctx.fillRect(0,0,this.width,this.height),this.renderGameOverTitle(),this.renderStats(),this.renderMenuButton()}renderGameOverTitle(){this.ctx.save(),this.ctx.textAlign="center";for(let t=3;t>0;t--)this.ctx.fillStyle=`rgba(255, 0, 0, ${.3/t})`,this.ctx.font="bold 100px serif",this.ctx.fillText("GAME OVER",this.width/2+this.titleShake+t*4,150+t*4);this.ctx.fillStyle=this.titleGradient,this.ctx.font="bold 100px serif",this.ctx.fillText("GAME OVER",this.width/2+this.titleShake,150),this.ctx.restore()}renderStats(){this.ctx.save(),this.ctx.textAlign="center";const t=280,e=50;this.ctx.fillStyle="#aaaaaa",this.ctx.font="bold 32px Arial",this.ctx.fillText("ESTADÃSTICAS FINALES",this.width/2,t),[{label:"Nivel Alcanzado",value:this.gameStats.level,color:"#bd00ff"},{label:"Oleada",value:this.gameStats.wave,color:"#ff6600"},{label:"TamaÃ±o del EjÃ©rcito",value:this.gameStats.armySize,color:"#00ffff"},{label:"PUNTUACIÃ“N TOTAL",value:this.gameStats.score,color:"#ffd700",bold:!0}].forEach((i,a)=>{const n=t+60+a*e;this.ctx.fillStyle="#888888",this.ctx.font=i.bold?"bold 28px Arial":"24px Arial",this.ctx.fillText(i.label,this.width/2-150,n),this.ctx.fillStyle=i.color,this.ctx.font=i.bold?"bold 32px Arial":"bold 28px Arial",this.ctx.fillText(i.value.toString(),this.width/2+150,n)}),this.ctx.restore()}renderMenuButton(){this.ctx.save();const t=this.menuButton,e=t.x+t.width/2,s=t.y+t.height/2;this.ctx.translate(e,s),this.ctx.scale(t.scale,t.scale),this.ctx.translate(-e,-s),t.hovered&&(this.ctx.shadowBlur=30,this.ctx.shadowColor="#ff6600");const i=t.hovered?this.buttonGradientHover:this.buttonGradientNormal;this.roundRect(t.x,t.y,t.width,t.height,10),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.strokeStyle=t.hovered?"#ffaa00":"#ff6600",this.ctx.lineWidth=t.hovered?3:2,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#ffffff",this.ctx.font="bold 28px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.text,e,s),this.ctx.restore()}roundRect(t,e,s,i,a){this.ctx.beginPath(),this.ctx.moveTo(t+a,e),this.ctx.lineTo(t+s-a,e),this.ctx.quadraticCurveTo(t+s,e,t+s,e+a),this.ctx.lineTo(t+s,e+i-a),this.ctx.quadraticCurveTo(t+s,e+i,t+s-a,e+i),this.ctx.lineTo(t+a,e+i),this.ctx.quadraticCurveTo(t,e+i,t,e+i-a),this.ctx.lineTo(t,e+a),this.ctx.quadraticCurveTo(t,e,t+a,e),this.ctx.closePath()}}function Y(){const v=document.getElementById("gameCanvas");if(!v){console.error("No se pudo encontrar el canvas");return}const t=new X(v);t.registerScene("menu",new j),t.registerScene("game",new x),t.registerScene("gameover",new tt),t.switchTo("menu"),t.start(),console.log("%cðŸŽ® Nigromante - El Invocador de las Sombras","color: #8b00ff; font-size: 20px; font-weight: bold;"),console.log("%cControles:","color: #00aaff; font-weight: bold;"),console.log("WASD - Movimiento"),console.log("ESPACIO - Atacar"),console.log("%cFase 5: MenÃº y Flujo de Juego implementado","color: #00ff00; font-weight: bold;"),console.log("%cDesarrollado con Vite + Canvas","color: #666; font-style: italic;"),window.sceneManager=t}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Y):Y();
